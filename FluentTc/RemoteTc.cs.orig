using System;
using FluentTc.Locators;

namespace FluentTc
{
    public class RemoteTc
    {
        public IConnectedTc Connect(Action<TeamCityConfigurationBuilder> connect)
        {
            var teamCityConfigurationBuilder = new TeamCityConfigurationBuilder();
            connect(teamCityConfigurationBuilder);
<<<<<<< HEAD
            m_Caller = new TeamCityCaller(teamCityConfigurationBuilder.GetITeamCityConnectionDetails());
            var buildProjectHavingBuilderFactory = new BuildProjectHavingBuilderFactory();
            var buildHavingBuilderFactory = new BuildHavingBuilderFactory(new BuildConfigurationHavingBuilderFactory(buildProjectHavingBuilderFactory), new UserHavingBuilderFactory(), new BranchHavingBuilderFactory(), buildProjectHavingBuilderFactory);
            m_BuildsRetriever = new BuildsRetriever(m_Caller, buildHavingBuilderFactory, new CountBuilderFactory(), new BuildIncludeBuilderFactory(), buildProjectHavingBuilderFactory);
            m_AgentsRetriever = new AgentsRetriever(m_Caller, new AgentHavingBuilderFactory());
            return new ConnectedTc(m_Caller, m_BuildsRetriever, m_AgentsRetriever);
=======
            ITeamCityCaller teamCityCaller = new TeamCityCaller(teamCityConfigurationBuilder.GetITeamCityConnectionDetails());
            var buildHavingBuilderFactory = new BuildHavingBuilderFactory(new BuildConfigurationHavingBuilderFactory(new BuildProjectHavingBuilderFactory()), new UserHavingBuilderFactory(), new BranchHavingBuilderFactory(), new BuildProjectHavingBuilderFactory());
            var buildsRetriever = new BuildsRetriever(teamCityCaller, buildHavingBuilderFactory, new CountBuilderFactory(), new BuildIncludeBuilderFactory());
            var projectsRetriever = new ProjectsRetriever(new BuildProjectHavingBuilderFactory(), teamCityCaller);
            return new ConnectedTc(buildsRetriever, new AgentsRetriever(teamCityCaller, new AgentHavingBuilderFactory()), projectsRetriever, new BuildConfigurationRetriever(new BuildConfigurationHavingBuilderFactory(new BuildProjectHavingBuilderFactory()), teamCityCaller));
>>>>>>> upstream/master
        }
    }
}